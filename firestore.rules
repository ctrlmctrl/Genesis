rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper functions for authentication and authorization
    function isAuthenticated() {
      return request.auth != null;
    }
    
    function getUserId() {
      return request.auth.uid;
    }
    
    function getUserEmail() {
      return request.auth.token.email;
    }
    
    function isAdmin() {
      return isAuthenticated() && 
             (getUserEmail() in ['ctrlmctrl@gmail.com', 'organizer@yourdomain.com', 'manager@yourdomain.com']);
    }
    
    function isVolunteer() {
      return isAuthenticated() && 
             (getUserEmail() in ['volunteer@yourdomain.com', 'staff@yourdomain.com', 'helper@yourdomain.com']);
    }
    
    function isStaff() {
      return isAdmin() || isVolunteer();
    }
    
    function isOwner(userId) {
      return isAuthenticated() && getUserId() == userId;
    }
    
    function isParticipantOwner(participantData) {
      return isAuthenticated() && getUserEmail() == participantData.email;
    }
    
    // Events collection - Allow public read access for development
    match /events/{eventId} {
      // Anyone can read events (for development)
      allow read: if true;
      
      // Allow create/update for development (restrict in production)
      allow create, update, delete: if true;
    }
    
    // Participants collection - Allow public access for development
    match /participants/{participantId} {
      // Allow all operations for development
      allow read, write: if true;
    }
    
    // Verification records collection - Allow public access for development
    match /verification_records/{recordId} {
      // Allow all operations for development
      allow read, write: if true;
    }
    
    // Team registrations - Allow public access for development
    match /teams/{teamId} {
      // Allow all operations for development
      allow read, write: if true;
    }
    
    // Payment records collection - Allow public access for development
    match /payments/{paymentId} {
      // Allow all operations for development
      allow read, write: if true;
    }
    
    // Admin collection - Allow public access for development
    match /admins/{adminId} {
      allow read, write: if true;
    }
    
    // Volunteer collection - Allow public access for development
    match /volunteers/{volunteerId} {
      allow read, write: if true;
    }
    
    // Analytics and reports - Allow public access for development
    match /analytics/{document=**} {
      allow read, write: if true;
    }
    
    // System configuration - Allow public access for development
    match /config/{document=**} {
      allow read, write: if true;
    }
    
    // Audit logs - Allow public access for development
    match /audit_logs/{logId} {
      allow read, write: if true;
    }
    
    // Default allow rule for development (restrict in production)
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
